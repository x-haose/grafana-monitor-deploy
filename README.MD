# Grafana Loki ç›‘æ§ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº Grafanaã€Lokiã€Prometheus çš„å®Œæ•´æ—¥å¿—å’Œç›‘æ§è§£å†³æ–¹æ¡ˆã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ“Š Grafana ä»ªè¡¨ç›˜å¯è§†åŒ–
- ğŸ“ Loki æ—¥å¿—èšåˆ
- ğŸ“ˆ Prometheus æŒ‡æ ‡ç›‘æ§
- ğŸ” å®¹å™¨å’Œä¸»æœºç›‘æ§
- ğŸš€ ä¸€é”®éƒ¨ç½²å’Œç®¡ç†

## ç³»ç»Ÿæ¶æ„

- **Grafana**: æ•°æ®å¯è§†åŒ–å¹³å°
- **Loki**: æ—¥å¿—èšåˆç³»ç»Ÿ
  - Read Node: æ—¥å¿—è¯»å–èŠ‚ç‚¹
  - Write Node: æ—¥å¿—å†™å…¥èŠ‚ç‚¹
  - Backend: åç«¯å¤„ç†èŠ‚ç‚¹
  - Gateway: ç½‘å…³èŠ‚ç‚¹
- **Prometheus**: æŒ‡æ ‡ç›‘æ§ç³»ç»Ÿ
- **Node Exporter**: ä¸»æœºæŒ‡æ ‡æ”¶é›†
- **cAdvisor**: å®¹å™¨æŒ‡æ ‡æ”¶é›†
- **Alloy**: Grafana æ—¥å¿—æ”¶é›†å™¨
- **MinIO**: å¯¹è±¡å­˜å‚¨åç«¯

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker Engine
- Docker Compose
- wget

### å®‰è£…æ­¥éª¤

1. å…‹éš†ä»“åº“ï¼š
```bash
git clone https://github.com/x-haose/grafana-monitor-deploy.git
cd grafana-monitor-deploy
```

2. é…ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
cp .env.example .env
# æ ¹æ®éœ€è¦ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„é…ç½®
```

3. é¦–æ¬¡éƒ¨ç½²ï¼š
```bash
chmod +x *.sh        # æ·»åŠ æ‰§è¡Œæƒé™
./deploy.sh          # éƒ¨ç½²æœåŠ¡
```

### æ—¥å¸¸æ“ä½œ

```bash
./start.sh          # å¯åŠ¨æœåŠ¡
./stop.sh           # åœæ­¢æœåŠ¡
./clean.sh          # æ¸…ç†æ‰€æœ‰æ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
```

## æœåŠ¡ç«¯å£

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| Grafana | 40020 | ä»ªè¡¨ç›˜ç•Œé¢ |
| Loki Gateway | 40010 | æ—¥å¿—ç½‘å…³ |
| Loki Read | 40011 | æ—¥å¿—è¯»å–æ¥å£ |
| Loki Write | 40012 | æ—¥å¿—å†™å…¥æ¥å£ |
| Alloy UI | 40030 | æ—¥å¿—æ”¶é›†å™¨ç•Œé¢ |

## é¢„é…ç½®ä»ªè¡¨ç›˜

ç³»ç»Ÿé¢„ç½®äº†ä»¥ä¸‹ Grafana ä»ªè¡¨ç›˜ï¼š

| ä»ªè¡¨ç›˜ | ID | è¯´æ˜ |
|--------|-----|------|
| Node Exporter Full | 1860 | ä¸»æœºç›‘æ§æŒ‡æ ‡ |
| Cadvisor Exporter | 14282 | å®¹å™¨ç›‘æ§æŒ‡æ ‡ |
| PostgreSQL Exporter | 14114 | PostgreSQL ç›‘æ§ |
| Redis Dashboard | 11835 | Redis ç›‘æ§ |

## è®¿é—®åœ°å€

- Grafana: http://127.0.0.1:40020
  - é»˜è®¤ç”¨æˆ·åï¼šadmin
  - é»˜è®¤å¯†ç ï¼šadmin
- Loki Gateway: http://127.0.0.1:40010
- Loki Read: http://127.0.0.1:40011/ready
- Loki Write: http://127.0.0.1:40012/ready
- Alloy UI: http://127.0.0.1:40030

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

ä¸»è¦é…ç½®é¡¹ï¼ˆåœ¨ .env æ–‡ä»¶ä¸­ï¼‰ï¼š
- `DASHBOARD_IDS`: Grafana ä»ªè¡¨ç›˜ ID
- å„æœåŠ¡ç«¯å£é…ç½®
- Grafana å’Œ MinIO çš„è®¿é—®å‡­æ®

### æ•°æ®æŒä¹…åŒ–

æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ `./data` ç›®å½•ä¸‹ï¼š
- `./data/grafana`: Grafana æ•°æ®
- `./data/minio`: MinIO æ•°æ®ï¼ˆLoki å­˜å‚¨ï¼‰
- `./data/prometheus`: Prometheus æ•°æ®

## æ³¨æ„äº‹é¡¹

1. é»˜è®¤é…ç½®ä¸ºæœ¬åœ°è®¿é—®æ¨¡å¼ï¼ˆ127.0.0.1ï¼‰ï¼Œå¦‚éœ€å¤–éƒ¨è®¿é—®ï¼š
   - ä¿®æ”¹ .env ä¸­çš„ç«¯å£é…ç½®
   - é…ç½®é€‚å½“çš„åŸŸåå’Œåå‘ä»£ç†
   - æ³¨æ„è®¾ç½®å®‰å…¨çš„è®¿é—®æ§åˆ¶

2. æ•°æ®å¤‡ä»½ï¼š
   - å®šæœŸå¤‡ä»½ `./data` ç›®å½•
   - ä½¿ç”¨ `clean.sh` å‰ç¡®ä¿æ•°æ®å·²å¤‡ä»½

## æ•…éšœæ’æŸ¥

å¸¸è§é—®é¢˜å¤„ç†ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
docker compose logs -f [æœåŠ¡å]

# é‡å¯ç‰¹å®šæœåŠ¡
docker compose restart [æœåŠ¡å]
```

## ç›¸å…³æ–‡æ¡£

- [Grafana æ–‡æ¡£](https://grafana.org.cn/docs/grafana/latest/)
- [Loki æ–‡æ¡£](https://grafana.org.cn/docs/loki/latest/get-started/quick-start)
- [Grafana Alloy æ–‡æ¡£](https://grafana.org.cn/docs/alloy/latest/)
